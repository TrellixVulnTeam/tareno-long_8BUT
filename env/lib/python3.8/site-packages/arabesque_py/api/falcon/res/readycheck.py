from falcon import Request, Response

from arabesque_py.api.falcon.response.response import Response as ServiceResponse

ready = False


class ReadyCheckResource:
    """
    This resource is just used for internal readiness checking to see if the
    service is ready to serve requests
    """

    require_authentication = False

    def on_get(self, request: Request, response: Response):
        """
        This internal resource handles checking if the service is ready to serve
        requests
        ---
        description: Readiness check returning a 200 response
        summary: Readiness check
        tags:
        - Test
        responses:
            200:
                description: Readiness check returning a 200 response
                content:
                    application/json:
                        schema:
                            type: object
                            additionalProperties:
                                type: string
            503:
                description: Ready check failed
                content:
                    application/json:
                        schema:
                            type: object
                            additionalProperties:
                                type: string
        """

        response = ServiceResponse(response)
        if ready:
            response.respond()
            return

        response.respond_503()
