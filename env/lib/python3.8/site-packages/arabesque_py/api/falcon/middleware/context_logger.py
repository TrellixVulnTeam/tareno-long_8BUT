import structlog
from falcon import Request, Response


class ContextLoggerMiddleware:
    def process_request(self, request: Request, response: Response):
        """
        This middleware inserts a new log instance into the context

        Args:
            request: The request
            response: The response
        """
        if request.context.request_id is not None:
            request.context.log = structlog.get_logger(
                request_id=request.context.request_id
            )
        else:
            request.context.log = structlog.get_logger()
