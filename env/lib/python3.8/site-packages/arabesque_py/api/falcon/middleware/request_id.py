from uuid import uuid4

import structlog
from falcon import Request, Response

from arabesque_py.api.falcon.context import ctx


class RequestIDMiddleware:
    def process_request(self, request: Request, response: Response):
        """
        This middleware inserts a request id into the request context.

        Args:
            request: The request
            response: The response
        """
        request_id = str(uuid4())
        ctx.request_id = request_id
        request.context.request_id = request_id
        response.set_header("X-Request-Id", request_id)
