from uuid import uuid4

from flask import Response, g

from arabesque_py.api.flask.middleware.middleware import Middleware


class RequestIDMiddleware(Middleware):
    def before_request(self):
        """
        Sets the request ID into the request context
        """
        request_id = str(uuid4())
        g.request_id = request_id

    def after_request(self, response: Response) -> Response:
        """
        Sets the request header for the response

        Args:
            response: The response for this request

        Returns:
            response: The flask response
        """
        response.headers.set("X-Request-Id", g.request_id)
        return response
