import structlog
from flask import g

from arabesque_py.api.flask.middleware.middleware import Middleware


class ContextLoggerMiddleware(Middleware):
    def before_request(self):
        """
        This middleware inserts a new log instance into the context
        """
        if g.request_id is not None:
            g.logger = structlog.get_logger(request_id=g.request_id)
        else:
            g.logger = structlog.get_logger()
