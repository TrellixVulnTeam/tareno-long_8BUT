import http


class Response:
    """
    This is meant as a helper for building responses for a service API
    """

    status: http.HTTPStatus = http.HTTPStatus.OK
    data = None
    errors = None

    def __init__(self, data=None):
        """
        Starts a new response flow.

        Args:
            data: You can set the data for the response here or set it later on
        """
        self.data = data

    def respond_404(self, errors=None):
        """
        Responds with a 404.

        Args:
            errors: Can customise the 404 error, or will use the default
        """
        self.status = http.HTTPStatus.NOT_FOUND
        if errors is None:
            errors = ["Item was not found"]
        self.errors = errors
        self.respond()

    def respond_503(self):
        """
        Responds with a 503.
        """
        self.status = http.HTTPStatus.SERVICE_UNAVAILABLE
        self.respond()

    def respond(self) -> tuple:
        """
        Sets all the Falcon params to what the service wants to respond with -
        remember to `return` after using this function.
        """
        response = {
            "status": self.get_status_code(),
            "status_desc": self.get_status_desc(),
        }

        if self.errors is not None:
            if not isinstance(self.errors, list):
                self.errors = [self.errors]
            response["errors"] = self.errors
        else:
            response["data"] = self.data

        return response, response["status"]

    def get_status_code(self) -> int:
        """
        Gets the status code from the status field
        Returns:
            status
        """
        return self.status.value

    def get_status_desc(self) -> str:
        """
        Gets the status description from the status field

        Returns:
            status_description
        """
        return self.status.phrase
