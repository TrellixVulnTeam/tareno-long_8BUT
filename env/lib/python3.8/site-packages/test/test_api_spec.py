from apispec import APISpec
from apispec.ext.marshmallow import MarshmallowPlugin

from arabesque_py.api.spec.default import DEFAULT_OPENAPI_VERSION, get_api_spec


def test_api_spec_basic():
    expected = APISpec(
        title="service",
        version="0.0.1",
        openapi_version=DEFAULT_OPENAPI_VERSION,
    )
    api_spec = get_api_spec(service="service", service_version="0.0.1")

    assert api_spec.title == expected.title
    assert api_spec.version == expected.version
    assert api_spec.openapi_version == expected.openapi_version


def test_api_spec_all_fields():
    plugins = [MarshmallowPlugin()]
    expected = APISpec(
        title="service",
        version="0.0.1",
        openapi_version=DEFAULT_OPENAPI_VERSION,
        info={
            "contact": {
                "name": "contact_name",
                "email": "contact_email@example.com",
            },
            "description": "example description",
        },
        plugins=plugins,
    )
    api_spec = get_api_spec(
        service="service",
        service_version="0.0.1",
        contact_name="contact_name",
        contact_email="contact_email@example.com",
        service_description="example description",
        plugins=plugins,
    )
    assert api_spec.title == expected.title
    assert api_spec.version == expected.version
    assert api_spec.openapi_version == expected.openapi_version
    assert api_spec.options == expected.options
    assert api_spec.plugins == expected.plugins
